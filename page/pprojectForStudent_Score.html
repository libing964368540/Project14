<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<META HTTP-EQUIV="pragma" CONTENT="no-cache">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="format-detection" content="telephone=no">
		<!-- load css -->
		<link rel="stylesheet" type="text/css" href="../layui/css/layui.css" media="all">
		<link rel="stylesheet" href="../css/public.css">
		<link rel="stylesheet" href="../font/material-icons.css">
		<link rel="stylesheet" href="../css/school_PublicStyle/school_PublicStyle.css">
	</head>
	<style type="text/css">
		#student_Score {
			padding: 45px 40px;
			box-sizing: border-box;
			background: #FFFFFF;
		}
		#student_Score .inputWrap{
			padding-top: 20px;
		}
		#student_Score .inputWrap ul li input{
		    width: 200px;
			display: inline-block;
			background: #f3f5f8;
			border: 1px solid #f3f5f8;
			line-height: 35px;
			height: 35px;
			box-sizing: border-box;
		}
		#student_Score .inputWrap ul li.chooseStudent input{
			width: 300px;
		}
		#student_Score .inputWrap ul li{
			margin-bottom: 20px;
		}
		#student_Score .btnWrap span.layui-btn{
			min-width: 200px;
			margin-bottom: 20px;
			margin-right: 35px;
			margin-left:0 ;
		}
		#student_Score .layui-form-select,.xm-form-select,.xm-select-parent {
            width: 200px;
			float: left;
			margin-right: 15px;
			border-radius: 0;
		}
		#student_Score .chooseStudent .layui-form-select,#student_Score .chooseStudent .xm-form-select,#student_Score .chooseStudent .xm-select-parent,#student_Score  ul li.chooseStudent input{
			width: 300px;
		}
		.xm-select-title{
			height: 35px!important;
			border-radius: 0;
			border: none;
		}
		#student_Score  ul li .layui-form-select input{
			width: 200px;
			border-radius: 0;
		}
		.ScoreFrom{
			display: none;
		}
		.ScoreFrom.switch{
			display: block;
		}
		#AllStudent{
			width: 300px;
			height: 35px;
			background: #f3f5f8;
			color: #999999;
			padding-left: 10px;
			line-height: 35px;
			font-size: 14px;
			cursor: pointer;
			display: inline-block;
		}
		.NoClick{
			position: relative;
		}
		.NoClick::before{
			content: '提交中...';
			position: absolute;
			left: 0;
			top: 0;
			width: 90%;
			height: 100%;
			background: #2196F3;
			z-index: 11;
			border-radius: 4px;
			text-align: right;
		}
	</style>
	<body>
		<div id="student_Score">
			<div class="head" style="position: relative">
				<span style="display: block;font-size: 24px;font-weight: bold;border-bottom:1px solid #ececec;padding-bottom: 25px;">为学生们的表现批量打分</span>
				<i class="rg " style="position: absolute;top:15px;right:0;color: #2196F3;cursor: pointer;font-style:normal;">导入表格</i>
			</div>
			<form class="layui-form ScoreFrom switch" >
                <div class="inputWrap">
                	<ul>
						<li class="clear chooseStudent">
							<label class="layui-form-label lf" style="padding-left: 0;width: 90px;text-align: left;color: #000000;opacity: 0.87">选择学生</label>
							<div id="AllStudent" class="lf">请选择学生</div>
						</li>
                		<li class="chooseStudent">
							<label class="layui-form-label lf" style="padding-left: 0;width: 90px;text-align: left;color: #000000;opacity: 0.87">选择打分项</label>
                			 <input type="text" placeholder="选择打分项" autocomplete="off" class="layui-input" readonly name="names">
							<i class="school_Btn borderRadiusRight"style="margin-left: -4px;" id="Choice">选择</i>
                		</li>
                	</ul>
                </div>
                <div class="btnWrap" style="padding-top: 20px;padding-bottom: 28px;">

					</div>
					<div class=""> <!-- 注意：这一层元素并不是必须的 -->
                          <label class="layui-form-label" style="padding-left: 0;text-align: left;width: 92px">考评日期</label>
                          <input type="text" class="layui-input" id="time" placeholder="请选择日期" style="background: #f3f5f8;
			border: 1px solid #f3f5f8;width: 300px;" readonly>
                    </div>
				<div style="margin-top: 42px">
					<textarea name="annotation" placeholder="可填写打分项备注" class="layui-textarea beizhu" style="background: #f3f5f8;border: none; border-radius:0 ;width: 730px;" id="annotation"></textarea>
				</div>

					<div class="layui-form-item" style="margin-top: 42px;width: 730px;text-align: center">
							<span class="layui-btn blue borderRadiusAll" lay-submit lay-filter="formDemo"  id="sumbit">提交</span>
					</div>
              
			</form>
			<form class="layui-form ScoreFrom ">
				  <ul style="padding: 42px 0;">
					  <li class="lf"><span class="layui-btn blue borderRadiusAll" id="DownFile">下载Excel打分模板</span></li>
					  <li class="lf" style="background: #f3f5f8;width: 340px;margin-left: 70px;padding-left: 24px;height: 35px;position: relative;"><span style="display: inline-block;position: relative;">
						   <span style="display:block;width: 80px;height: 25px;background: #b1b1b1;line-height: 25px;color: #ffffff;text-align: center;cursor: pointer;float: left;margin-top: 5px;">选择文件</span>
						   <p style="display: block;width: 170px;overflow: hidden;white-space: nowrap;text-overflow: ellipsis;line-height: 35px;float: left;padding-left: 5px;" class="Filename">未选择任何文件</p>
						  <input type="file" style="padding-top: 5px;width: 80px;height: 25px;position: absolute;left: 0;top: 0px;opacity: 0" onchange="tool().upFile($(this))"></span>
						  <!--<span class="school_Btn"  onclick="tool().upFileAjax($(this))"style="position: absolute;right: 0;top:0;">上传</span>-->
						  <span class="school_Btn borderRadiusRight"style="position: absolute;right: 0;top:0;" id="UpFile">上传</span>
					  </li>
				  </ul>
			</form>
		</div>
	</body>
	<!-- 加载js文件 -->
	<script type="text/javascript" src="../layui/layui.js"></script>
	<script type="text/javascript" src="../js/lib/jquery-1.12.4.min.js"></script>
	<script type="text/javascript" src="../js/lib/jquery.cookie.js"></script>
	<script type="text/javascript" src="../js/all2.js"></script>
	<script type="text/javascript" src="../tool/mask.js"></script>
	<script type="text/javascript" src="../js/leave/jquery.ztree.core.min.js"></script>
	<script type="text/javascript" src="../js/lib/jquery.ztree.excheck.js"></script>
	<script type="text/javascript" src="../tool/choose_Score.js"></script>
	<script type="text/javascript" src="../tool/tool.js"></script>
	<script type="text/javascript" src="../tool/classgrade_Tree.js"></script>
	<script type="text/javascript" src="../tool/choose_student.js"></script>
	<script type="text/javascript" src="../tool/File.js"></script>
	<script type="text/javascript" src="../tool/rules.js"></script>
	<!-- 引入当前页面js文件 -->
	<script type="text/javascript">
		layui.use(['layer', 'form', 'element','laydate'], function() {
			layer = parent.layer === undefined ? layui.layer : top.layer
			form = layui.form ;
			layui.use('laydate', function(){
              var laydate = layui.laydate;
                    //执行一个laydate实例
                laydate.render({
                      elem: '#time', //指定元素
                      format: 'yyyy-MM-dd'
                    });
                });
            //选择打分项
            var p2 = new choose_Score('Choice',studentRecord,{free:0},function (projectid) {
                var rules=new getRulesForStudet(projectid,$('.btnWrap'));
            });

            //选择学生树形结构
            var pp1= new choose_Student('AllStudent',{
                url:'/account/getAccountsForStudent.action',
                field:1,
                treeType:1   //以年级tree为开头
			});
            //下载学籍号打分模板
			var download_Score = new DownLoadTemplate('DownFile',{
			    url:'/file/getOperationXlsPath.action'
			})
			//上传导表
			var UpTemplate_Score = new UpTemplate('UpFile',{
				url:'/file/uploadOperationForStudentNumber.action',
				filed:'',
				tip:'确认上传此表格进行批量打分',
				NoFile_Tip:"请先上传打分文件"
			})
            //选择打分项弹框
             student_Score=(function () {
				var _m={};
				var self=_m;
				 // 初始化
				_m.init=function () {
					self.sumbit();
					self.switch();
//					self.switchRole();
                }
                //获取班级打分规则
                //点击提交
				_m.sumbit = function () {
                    $('#sumbit').unbind('click').bind('click', function () {
                        var that = $(this);
                        if($(this).hasClass('NoClick')){
                            return;
						}
                        tool().Switched_Roles('images1/Score.png','确定提交本次打分？',function () {
                            var arr = [];
                            if (!$.trim($("#AllStudent").attr('title'))) {
                                sl_Mask.NoTip('请选择学生');
                                return;
                            }
                            if ($('.btnWrap').find('span.blue').length == 0) {
                                sl_Mask.NoTip('请选择打分规则');
                                return;
                            } else {
                                for (var i = 0; i < $('.btnWrap').find('span.blue').length; i++) {
                                    arr.push($('.btnWrap').find('span.blue').eq(i).attr('data-id'))
                                }
                            }
                            var params = {
                                faid: userId,
                                token: token,
//                                taids: $('input[name="AllStudent"]').val(),
								taids:$("#AllStudent").attr('data-id'),
                                rids: arr.join("-")
                            }
                            //打分时间
                            if ($.trim($('#time').val())) {
                                params.time = new Date($('#time').val().replace(/-/g,"/")+' 00:00:00').getTime()
                            }
                            //打分备注
                            if ($.trim($('#annotation').val())) {
                                params.annotation = $.trim($('#annotation').val());
                            }
                            that.addClass('NoClick');
                            tool().onClick(that);
//                            var loadings= top.layui.layer.load(2);
                            $.axse(urls + addStudent_Record, params, function (result) {
                                that.removeClass('NoClick');
                                $('.fading-circle').remove();
//                                   top.layui.layer.close(loadings);
                                     sl_Mask.YesTip('打分成功');
                                    //清空班级
//                                    formSelects.value('classgaderid', []);
									//清空学生
//                                    formSelects.value('cids', []);
                                $('#AllStudent').attr('data-id','');
                                $('#AllStudent').attr('title','');
                                $('#AllStudent').html('').text('请选择学生');
                                    //打分规则
									$('input[name=names]').val('');
                                    $('.btnWrap').empty();
                                    //打分时间
                                    $('#time').val('');
                                    //备注
                                    $('.beizhu').val('');

                            },function () {
                                that.removeClass('NoClick');
                                $('.fading-circle').remove();
//                                top.layui.layer.close(loadings);
                            })
                        })
                    })
                }
                //切换导表方式
				_m.switch = function () {
				   $('.head i').unbind('click').bind('click',function () {
				       if($(this).hasClass('switch')){
                           $(this).removeClass('switch');
                           $(this).text('导入表格');
                           $('.head span').text('为学生们的表现批量打分');
                           $('.ScoreFrom').hide();
                           $('.ScoreFrom').eq(0).show();
                       }else {
                           $(this).addClass('switch');
                           $(this).text('返回');
                           $('.head span').text('导入Excel表格进行批量打分');
                           $('.ScoreFrom').hide();
                           $('.ScoreFrom').eq(1).show();
					   }
                   })
                }
                //页面切换到专业部时,对下拉框的处理
				_m.switchRole = function (values) {
                    var params ={
                        faid:userId,
                        token:token
                    }
                    $.axse(urls+Get_MajorGroup,params,function(result){
                        var dom="<option value=''>选择专业部</option>";
                        var data=result.data;
                        if(data&&data.length>0) {
                            for (var i = 0; i < data.length; i++) {
                                dom += '<option value="' + data[i].id + '">' + data[i].name + '</option>'
                            }
                            $(".groupid").html(dom);
                            layui.form.render();
                        }
                        if(values){
                            $(".groupid").val(values);
                            layui.form.render();
//                            $(".groupid").attr('disabled','true');
//                            layui.form.render();
                            tool().editMajor($('#student_Score'),values,'',1);
						}
					})
                }
				return _m;
            })();
            student_Score.init();
		})
	</script>

</html>